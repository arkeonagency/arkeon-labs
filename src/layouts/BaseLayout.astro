---
import '../styles/global.css';
import Navbar from '../components/Navbar.jsx';
import Footer from '../components/Footer.jsx';
import 'aos/dist/aos.css';
import CookieBanner from '../components/CookieBanner.jsx';

// 1. NEW: Import View Transitions
import { ViewTransitions } from 'astro:transitions';

// Import Local Fonts
import '@fontsource/inter/400.css';
import '@fontsource/inter/600.css';
import '@fontsource/playfair-display/400.css';
import '@fontsource/playfair-display/600.css';
import '@fontsource/playfair-display/700.css';

const currentPath = Astro.url.pathname;
---

<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>Arkeon Studio</title>
    
    <style is:global>
      @font-face { font-family: 'Inter'; font-display: swap; }
      @font-face { font-family: 'Playfair Display'; font-display: swap; }
    </style>

    {/* Preload Critical Fonts */}
    <link rel="preload" href="/fonts/inter-latin-400-normal.woff2" as="font" type="font/woff2" crossorigin />
    <link rel="preload" href="/fonts/playfair-display-latin-700-normal.woff2" as="font" type="font/woff2" crossorigin />

    <!-- GOOGLE ANALYTICS (GA4) - Moved to Partytown -->
    <script type="text/partytown" async src="https://www.googletagmanager.com/gtag/js?id=G-KWH8FBPTYE"></script>
    <script type="text/partytown">
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-KWH8FBPTYE');
    </script>

    <!-- MICROSOFT CLARITY - Moved to Partytown -->
    <script type="text/partytown">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "ugnyme494i");
    </script>
    <!-- JSON-LD Structured Data (The "Local Authority" Signal) -->
    <script type="application/ld+json">
      {
        "@context": "https://schema.org",
        "@type": "ProfessionalService",
        "name": "Arkeon Studio",
        "image": "https://arkeon.com.et/images/og-default.jpg",
        "url": "https://arkeon.com.et",
        "telephone": "+251971966575", 
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "Bole Atlas",
          "addressLocality": "Addis Ababa",
          "addressCountry": "ET"
        },
        "priceRange": "ETB 20000 - ETB 200000+",
        "openingHoursSpecification": {
          "@type": "OpeningHoursSpecification",
          "dayOfWeek": [
            "Monday",
            "Tuesday",
            "Wednesday",
            "Thursday",
            "Friday",
            "Saturday",
            "Sunday"
          ],
          "opens": "09:00",
          "closes": "18:00"
        }
      }
    </script>

  </head>
  <body class="bg-arkeon-charcoal text-white overflow-x-hidden selection:bg-arkeon-gold selection:text-arkeon-charcoal flex flex-col min-h-screen">
    
    {/* 
        transition:persist ensures the Navbar doesn't reload/flash 
        when you move between pages. It stays steady.
    */}
    <div transition:persist>
      <Navbar client:load path={currentPath} />
    </div>

    <main class="flex-grow pt-20" transition:animate="fade">
      <slot />
    </main>
    
    

    <Footer client:visible />
    
    <CookieBanner client:idle />

    <script>
      import AOS from 'aos';
      
      // 3. NEW: Handle Animations on Navigation
      // We wrap the init logic in a function
      function initAnimations() {
        AOS.init({
          duration: 800,
          once: true,
          easing: 'ease-out-cubic',
          offset: 50,
          disable: 'mobile' 
        });
      }

      // Run on initial load
      initAnimations();

      // Run on every page navigation (View Transition)
      document.addEventListener('astro:page-load', () => {
        initAnimations();
      });
    </script>
  </body>
</html>